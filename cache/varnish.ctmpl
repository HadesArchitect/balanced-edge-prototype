vcl 4.0;

import directors;
{{range service "app"}}
backend {{.Name}}_{{.Node}}_{{.Port}} {
    .host = "{{.Address}}";
    .port = "{{.Port}}";
}{{end}}

sub vcl_init {
  new bar = directors.round_robin();
{{range service "app"}}
  bar.add_backend({{.Name}}_{{.Node}}_{{.Port}});{{end}}
}

sub vcl_recv {
  set req.backend_hint = bar.backend();
}
